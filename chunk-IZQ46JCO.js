import{a as Z}from"./chunk-UGWILRM6.js";import{Ca as A,Ja as U,Na as C,Oa as d,Pa as l,Qa as q,Ra as Y,Sa as H,Ta as Q,Ua as V,V as a,W as c,Wa as m,X as B,Xa as K,Ya as S,Za as I,_a as j,ab as g,c as z,ca as h,cb as J,gb as N,hb as T,jb as O,kb as D,pa as L,qa as u}from"./chunk-IIQYDPTD.js";var ne=["svgCanvas"],oe=["contentGroup"],G=class _{svgElement=D.required("svgCanvas");contentGroup=D.required("contentGroup");color=O("#0c62f0");width=O(6);mode=O("draw");currentColor=h("#0c62f0");strokeWidth=h(6);currentMode=h("draw");paths=h([]);constructor(){T(()=>this.currentColor.set(this.color())),T(()=>this.strokeWidth.set(this.width())),T(()=>this.currentMode.set(this.mode()))}scale=h(1);tx=h(0);ty=h(0);MIN_SCALE=.05;MAX_SCALE=20;isDrawing=!1;activePath=null;activePathColor="";activePathWidth=0;isPanning=!1;panPointerId=null;panAnchorWorld=null;pointers=new Map;pinchActive=!1;pinchInitialScale=1;pinchInitialDist=1;pinchAnchorWorld=null;isErasing=!1;erasePrevScreen=null;spacePressed=!1;transform=N(()=>`translate(${this.tx()},${this.ty()}) scale(${this.scale()})`);status=N(()=>{let e=this.scale(),i=this.tx(),t=this.ty(),n=this.currentMode();return`scale=${e.toFixed(3)} tx=${i.toFixed(1)} ty=${t.toFixed(1)} | mode=${n}`});cursor=N(()=>this.spacePressed||this.isPanning?this.isPanning?"grabbing":"grab":"crosshair");nextId=0;generateId(){return`path-${Date.now()}-${this.nextId++}`}onKeyDown(e){e.code==="Space"&&!e.repeat&&(this.spacePressed=!0,e.preventDefault())}onKeyUp(e){e.code==="Space"&&(this.spacePressed=!1)}getBoardRect(){return this.svgElement().nativeElement.getBoundingClientRect()}screenToLocalCanvas(e,i){let t=this.getBoardRect();return{x:e-t.left,y:i-t.top}}screenToWorld(e,i){let{x:t,y:n}=this.screenToLocalCanvas(e,i);return{x:(t-this.tx())/this.scale(),y:(n-this.ty())/this.scale()}}dist2D(e,i){return Math.hypot(e.x-i.x,e.y-i.y)}sampleSegmentPoints(e,i,t=8){let n=this.dist2D(e,i),o=Math.max(1,Math.ceil(n/t)),r=[];for(let s=0;s<=o;s++){let p=s/o;r.push({x:e.x+(i.x-e.x)*p,y:e.y+(i.y-e.y)*p})}return r}clampScale(e){return Math.min(this.MAX_SCALE,Math.max(this.MIN_SCALE,e))}shouldPan(e){return!!(e.button===1||this.spacePressed&&e.button===0)}onPointerDown(e){if(this.svgElement().nativeElement.setPointerCapture(e.pointerId),this.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),this.pointers.size===2){this.cancelDraw(),this.endErase(),this.isPanning=!1,this.startPinch();return}if(this.shouldPan(e)){this.endErase(),this.startPan(e);return}this.currentMode()==="draw"?this.startDraw(e):this.currentMode()==="erase"&&this.startErase(e)}onPointerMove(e){if(this.pointers.has(e.pointerId)&&this.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),this.pinchActive){this.updatePinch();return}if(this.isPanning){this.continuePan(e);return}this.currentMode()==="draw"?this.continueDraw(e):this.currentMode()==="erase"&&this.continueErase(e)}onPointerUp(e){let i=this.svgElement().nativeElement;this.pointers.has(e.pointerId)&&this.pointers.delete(e.pointerId),this.pinchActive&&this.pointers.size<2&&this.endPinch(),this.isPanning&&this.endPan(e),this.currentMode()==="draw"?this.endDraw():this.currentMode()==="erase"&&this.endErase(),i.releasePointerCapture(e.pointerId)}onPointerCancel(e){let i=this.svgElement().nativeElement;this.pointers.has(e.pointerId)&&this.pointers.delete(e.pointerId),this.pinchActive&&this.pointers.size<2&&this.endPinch(),this.endDraw(),this.endPan(e),this.endErase(),i.releasePointerCapture(e.pointerId)}onWheel(e){e.preventDefault();let i=Math.pow(1.0015,-e.deltaY),t=this.screenToWorld(e.clientX,e.clientY),n=this.screenToLocalCanvas(e.clientX,e.clientY),o=this.clampScale(this.scale()*i);this.tx.set(n.x-o*t.x),this.ty.set(n.y-o*t.y),this.scale.set(o)}startDraw(e){if(this.pointers.size>1)return;this.isDrawing=!0;let{x:i,y:t}=this.screenToWorld(e.clientX,e.clientY);this.activePathColor=this.currentColor(),this.activePathWidth=this.strokeWidth(),this.activePath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.activePath.setAttribute("fill","none"),this.activePath.setAttribute("stroke",this.activePathColor),this.activePath.setAttribute("stroke-width",String(this.activePathWidth)),this.activePath.setAttribute("stroke-linecap","round"),this.activePath.setAttribute("stroke-linejoin","round"),this.activePath.setAttribute("d",`M ${i} ${t}`),this.contentGroup().nativeElement.appendChild(this.activePath)}continueDraw(e){if(!this.isDrawing||!this.activePath)return;let{x:i,y:t}=this.screenToWorld(e.clientX,e.clientY),n=this.activePath.getAttribute("d")+` L ${i} ${t}`;this.activePath.setAttribute("d",n)}endDraw(){if(this.isDrawing&&this.activePath){let e=this.activePath.getAttribute("d")||"",i={id:this.generateId(),d:e,color:this.activePathColor,width:this.activePathWidth};this.activePath.setAttribute("data-id",i.id),this.paths.update(t=>[...t,i])}this.isDrawing=!1,this.activePath=null,this.activePathColor="",this.activePathWidth=0}cancelDraw(){this.activePath&&this.activePath.remove(),this.isDrawing=!1,this.activePath=null,this.activePathColor="",this.activePathWidth=0}startPan(e){this.isPanning=!0,this.panPointerId=e.pointerId,this.panAnchorWorld=this.screenToWorld(e.clientX,e.clientY)}continuePan(e){if(!this.isPanning||e.pointerId!==this.panPointerId||!this.panAnchorWorld)return;let i=this.screenToLocalCanvas(e.clientX,e.clientY);this.tx.set(i.x-this.scale()*this.panAnchorWorld.x),this.ty.set(i.y-this.scale()*this.panAnchorWorld.y)}endPan(e){e.pointerId===this.panPointerId&&(this.isPanning=!1,this.panPointerId=null,this.panAnchorWorld=null)}startPinch(){let e=Array.from(this.pointers.keys());if(e.length!==2)return;this.pinchActive=!0;let i=this.pointers.get(e[0]),t=this.pointers.get(e[1]),n={x:(i.x+t.x)/2,y:(i.y+t.y)/2};this.pinchInitialDist=this.dist2D(i,t),this.pinchInitialScale=this.scale(),this.pinchAnchorWorld=this.screenToWorld(n.x,n.y)}updatePinch(){let e=Array.from(this.pointers.keys());if(e.length!==2||!this.pinchActive||!this.pinchAnchorWorld)return;let i=this.pointers.get(e[0]),t=this.pointers.get(e[1]),n=this.dist2D(i,t),o=this.pinchInitialScale*(n/this.pinchInitialDist);o=this.clampScale(o);let r={x:(i.x+t.x)/2,y:(i.y+t.y)/2},s=this.screenToLocalCanvas(r.x,r.y);this.tx.set(s.x-o*this.pinchAnchorWorld.x),this.ty.set(s.y-o*this.pinchAnchorWorld.y),this.scale.set(o)}endPinch(){this.pinchActive=!1,this.pinchAnchorWorld=null}startErase(e){this.isErasing=!0,this.erasePrevScreen={x:e.clientX,y:e.clientY}}continueErase(e){if(!this.isErasing)return;let i={x:e.clientX,y:e.clientY};if(!this.erasePrevScreen){this.erasePrevScreen=i;return}let t=this.sampleSegmentPoints(this.erasePrevScreen,i,8),n=new Set;for(let o of t){let r=document.elementFromPoint(o.x,o.y);if(!r)continue;let s=r.getAttribute?.("data-id");s&&r.closest?.("#contentGroup")&&n.add(s)}n.size>0&&(this.paths.update(o=>o.filter(r=>!n.has(r.id))),n.forEach(o=>{this.contentGroup().nativeElement.querySelector(`[data-id="${o}"]`)?.remove()})),this.erasePrevScreen=i}endErase(){this.isErasing=!1,this.erasePrevScreen=null}loadSvgContent(e){try{let t=new DOMParser().parseFromString(e,"image/svg+xml").documentElement,n=this.contentGroup().nativeElement;for(;n.firstChild;)n.removeChild(n.firstChild);this.tx.set(0),this.ty.set(0),this.scale.set(1);let o=r=>{for(let s of Array.from(r.childNodes)){if(s.nodeType!==1)continue;let p=s,w=p.tagName.toLowerCase();if(["style","script","title","desc","defs"].includes(w))continue;if(w==="g"){o(p);continue}let P=document.importNode(p,!0),x=this.generateId();P.setAttribute("data-id",x),w==="path"&&P.setAttribute("fill","none"),n.appendChild(P)}};o(t),this.fitToView()}catch(i){console.error(i),alert("Failed to parse SVG file.")}}fitToView(){let i=this.contentGroup().nativeElement.querySelectorAll("path");if(i.length===0){this.tx.set(0),this.ty.set(0),this.scale.set(1);return}let t=1/0,n=1/0,o=-1/0,r=-1/0;if(i.forEach(R=>{let f=(R.getAttribute("d")||"").match(/[\d.-]+/g);if(f)for(let b=0;b<f.length;b+=2){let y=parseFloat(f[b]),X=parseFloat(f[b+1]);!isNaN(y)&&!isNaN(X)&&(t=Math.min(t,y),n=Math.min(n,X),o=Math.max(o,y),r=Math.max(r,X))}}),!isFinite(t)){this.tx.set(0),this.ty.set(0),this.scale.set(1);return}let s=50,p=o-t+s*2,w=r-n+s*2,P=this.getBoardRect(),x=P.width,W=P.height,$=x/p,k=W/w,v=Math.min($,k,1),F=(t+o)/2,E=(n+r)/2;this.scale.set(v),this.tx.set(x/2-F*v),this.ty.set(W/2-E*v)}saveSVG(){let i=this.contentGroup().nativeElement.querySelectorAll("path");if(i.length===0){alert("Nothing to save");return}let t=1/0,n=1/0,o=-1/0,r=-1/0;i.forEach(E=>{let M=(E.getAttribute("d")||"").match(/[\d.-]+/g);if(M)for(let f=0;f<M.length;f+=2){let b=parseFloat(M[f]),y=parseFloat(M[f+1]);!isNaN(b)&&!isNaN(y)&&(t=Math.min(t,b),n=Math.min(n,y),o=Math.max(o,b),r=Math.max(r,y))}});let s=20;t-=s,n-=s,o+=s,r+=s;let p=o-t,w=r-n,P=Array.from(i).map(E=>new XMLSerializer().serializeToString(E)).join(`
`),W=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="${t} ${n} ${p} ${w}" preserveAspectRatio="xMidYMid meet">

  <style>
    html, body { height: 100%; margin: 0; background: #fff; }
    svg { width: 100vw; height: 100vh; display: block; background: #fff; }
    path { fill: none; stroke-linecap: round; stroke-linejoin: round; }
  </style>
<rect x="${t}" y="${n}" width="${p}" height="${w}" fill="white"/>
${P}
</svg>`,$=new Blob([W],{type:"image/svg+xml"}),k=URL.createObjectURL($),v=document.createElement("a"),F=new Date().toISOString().replace(/[:.]/g,"-");v.download=`whiteboard-${F}.svg`,v.href=k,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(k)}clearCanvas(){this.paths.set([]);let e=this.contentGroup().nativeElement;for(;e.firstChild;)e.removeChild(e.firstChild);this.tx.set(0),this.ty.set(0),this.scale.set(1)}static \u0275fac=function(i){return new(i||_)};static \u0275cmp=A({type:_,selectors:[["app-whiteboard4"]],viewQuery:function(i,t){i&1&&(S(t.svgElement,ne,5),S(t.contentGroup,oe,5)),i&2&&I(2)},hostBindings:function(i,t){i&1&&m("keydown",function(o){return t.onKeyDown(o)},L)("keyup",function(o){return t.onKeyUp(o)},L)},inputs:{color:[1,"color"],width:[1,"width"],mode:[1,"mode"]},decls:6,vars:3,consts:[["svgCanvas",""],["contentGroup",""],[1,"whiteboard-container"],[1,"svg-canvas",3,"pointerdown","pointermove","pointerup","pointercancel","pointerleave","wheel","auxclick"],["x","0","y","0","width","100%","height","100%","fill","white",1,"hit-area"],["id","contentGroup"]],template:function(i,t){if(i&1){let n=V();Y(0,"div",2),B(),Y(1,"svg",3,0),K("pointerdown",function(r){return a(n),c(t.onPointerDown(r))})("pointermove",function(r){return a(n),c(t.onPointerMove(r))})("pointerup",function(r){return a(n),c(t.onPointerUp(r))})("pointercancel",function(r){return a(n),c(t.onPointerCancel(r))})("pointerleave",function(r){return a(n),c(t.onPointerUp(r))})("wheel",function(r){return a(n),c(t.onWheel(r))})("auxclick",function(r){return a(n),c(r.preventDefault())}),Q(3,"rect",4)(4,"g",5,1),H()()}i&2&&(u(),j("cursor",t.cursor()),u(3),U("transform",t.transform()))},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%;overflow:hidden}.whiteboard-container[_ngcontent-%COMP%]{width:100%;height:100%;background:#fff}.svg-canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block;touch-action:none;background:#fff}.hit-area[_ngcontent-%COMP%]{fill:#fff}"],changeDetection:0})};var re=["whiteboard"],ee=class _{whiteboard=D.required("whiteboard");color=h("#0c62f0");strokeWidth=h(6);mode=h("draw");onFileSelected(e){return z(this,null,function*(){let i=e.target,t=i.files?.[0];if(t)try{let n=yield t.text();this.whiteboard().loadSvgContent(n)}catch(n){console.error(n),alert("Failed to read file.")}finally{i.value=""}})}saveSVG(){this.whiteboard().saveSVG()}clearCanvas(){this.whiteboard().clearCanvas()}static \u0275fac=function(i){return new(i||_)};static \u0275cmp=A({type:_,selectors:[["app-page4"]],viewQuery:function(i,t){i&1&&S(t.whiteboard,re,5),i&2&&I()},decls:31,vars:8,consts:[["whiteboard",""],[1,"page-container"],[1,"toolbar"],[1,"toolbar-section"],["for","openFile4",1,"file-btn"],["id","openFile4","type","file","accept",".svg,image/svg+xml","hidden","",3,"change"],["title","Save as SVG",1,"action-btn",3,"click"],[1,"input-label"],["type","color",1,"color-picker",3,"input","value"],["type","range","min","1","max","40",1,"width-slider",3,"input","value"],[1,"width-value"],[1,"toolbar-section","mode-group"],[1,"mode-radio"],["type","radio","name","mode","value","draw",3,"change","checked"],["type","radio","name","mode","value","erase",3,"change","checked"],["title","Clear canvas",1,"action-btn","danger",3,"click"],[3,"color","width","mode"]],template:function(i,t){if(i&1){let n=V();d(0,"div",1)(1,"h1"),g(2,"Page 4"),l(),d(3,"div",2)(4,"div",3)(5,"label",4),g(6,"Open SVG"),l(),d(7,"input",5),m("change",function(r){return a(n),c(t.onFileSelected(r))}),l(),d(8,"button",6),m("click",function(){return a(n),c(t.saveSVG())}),g(9,"Save SVG"),l()(),d(10,"div",3)(11,"label",7),g(12," Color: "),d(13,"input",8),m("input",function(r){return a(n),c(t.color.set(r.target.value))}),l()(),d(14,"label",7),g(15," Width: "),d(16,"input",9),m("input",function(r){return a(n),c(t.strokeWidth.set(+r.target.value))}),l(),d(17,"span",10),g(18),l()()(),d(19,"div",11)(20,"label",12)(21,"input",13),m("change",function(){return a(n),c(t.mode.set("draw"))}),l(),g(22," Draw "),l(),d(23,"label",12)(24,"input",14),m("change",function(){return a(n),c(t.mode.set("erase"))}),l(),g(25," Erase "),l()(),d(26,"div",3)(27,"button",15),m("click",function(){return a(n),c(t.clearCanvas())}),g(28,"Clear"),l()()(),q(29,"app-whiteboard4",16,0),l()}i&2&&(u(13),C("value",t.color()),u(3),C("value",t.strokeWidth()),u(2),J("",t.strokeWidth(),"px"),u(3),C("checked",t.mode()==="draw"),u(3),C("checked",t.mode()==="erase"),u(5),C("color",t.color())("width",t.strokeWidth())("mode",t.mode()))},dependencies:[G,Z],styles:["[_nghost-%COMP%]{display:block;height:100vh}.page-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}h1[_ngcontent-%COMP%]{margin:0;padding:.5rem 1rem;font-size:1.25rem;background:#f5f5f5;border-bottom:1px solid #ddd}.toolbar[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;padding:10px 12px;background:#fff;border-bottom:1px solid #ddd;-webkit-user-select:none;user-select:none;flex-wrap:wrap}@media (max-width: 640px){.toolbar[_ngcontent-%COMP%]{gap:8px}}.toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}@media (max-width: 640px){.toolbar-section[_ngcontent-%COMP%]{gap:8px}}.mode-group[_ngcontent-%COMP%]{display:inline-flex;gap:12px;align-items:center}.mode-radio[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;font-size:14px;cursor:pointer}.input-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:14px}.width-value[_ngcontent-%COMP%]{min-width:32px}.color-picker[_ngcontent-%COMP%]{width:40px;height:28px;border:1px solid #aaa;border-radius:4px;cursor:pointer;padding:0}.width-slider[_ngcontent-%COMP%]{width:80px;cursor:pointer}.file-btn[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%]{padding:6px 10px;border:1px solid #aaa;border-radius:6px;background:#fafafa;cursor:pointer;font-size:14px}.file-btn[_ngcontent-%COMP%]:hover, .action-btn[_ngcontent-%COMP%]:hover{background:#f0f0f0}.file-btn[_ngcontent-%COMP%]{display:inline-block}.action-btn.danger[_ngcontent-%COMP%]{color:#d32f2f}.action-btn.danger[_ngcontent-%COMP%]:hover{background:#ffebee;border-color:#d32f2f}app-whiteboard4[_ngcontent-%COMP%]{flex:1;min-height:0}"],changeDetection:0})};export{ee as Page4Component};
