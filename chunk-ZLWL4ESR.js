import{a as Z}from"./chunk-J2Q67PLX.js";import{$a as m,Ca as y,Ja as k,Ka as $,La as A,Ma as L,Na as G,Oa as z,Pa as R,Qa as l,Ra as p,Sa as I,Ta as N,Ua as T,V as a,W as c,Wa as u,X as V,Xa as Y,Ya as X,_a as M,a as E,b as S,bb as H,ca as b,fb as U,gb as j,jb as q,pa as F,qa as g,tb as Q}from"./chunk-KOEGKTWC.js";var ot=["svgCanvas"];function rt(f,t){if(f&1&&(V(),I(0,"path",15)),f&2){let n=t.$implicit;k("d",n.d)("stroke",n.color)("stroke-width",n.width)}}var D=class f{svgElement=q.required("svgCanvas");paths=b([]);currentColor=b("#000000");strokeWidth=b(2);mode=b("draw");isDrawing=!1;currentPath=[];lastPoint=null;isPanning=!1;panStartScreen=null;viewBox=b({x:0,y:0,width:1e3,height:1e3});scale=b(1);touches=new Map;initialPinchDistance=null;initialScale=1;pinchCenter=null;viewBoxString=U(()=>`${this.viewBox().x} ${this.viewBox().y} ${this.viewBox().width} ${this.viewBox().height}`);constructor(){j(()=>{this.updateViewBox()})}updateViewBox(){if(typeof window>"u")return;let t=window.innerWidth,n=window.innerHeight,e=this.scale();this.viewBox.update(i=>S(E({},i),{width:t/e,height:n/e}))}onWindowResize(){this.updateViewBox()}onPointerDown(t){let n=this.getPoint(t);if(n)if(this.mode()==="draw")this.startDrawing(n);else if(this.mode()==="pan"){let e=this.getScreenPoint(t);e&&this.startPanning(e)}else this.mode()==="erase"&&this.eraseAt(n)}onPointerMove(t){let n=this.getPoint(t);if(n)if(this.isDrawing&&this.mode()==="draw")this.addPointToPath(n);else if(this.isPanning&&this.mode()==="pan"){let e=this.getScreenPoint(t);e&&this.pan(e)}else this.mode()==="erase"&&t.buttons===1&&this.eraseAt(n)}onPointerUp(){this.isDrawing&&this.finishDrawing(),this.isPanning=!1,this.panStartScreen=null}onTouchStart(t){t.preventDefault();for(let n=0;n<t.touches.length;n++){let e=t.touches[n],i=this.getTouchPoint(e);i&&this.touches.set(e.identifier,i)}if(t.touches.length===2)this.initialPinchDistance=this.getPinchDistance(),this.initialScale=this.scale(),this.pinchCenter=this.getPinchCenter();else if(t.touches.length===1){let n=this.getTouchPoint(t.touches[0]);if(!n)return;if(this.mode()==="draw")this.startDrawing(n);else if(this.mode()==="pan"){let e=this.getScreenPoint(t.touches[0]);this.startPanning(e)}else this.mode()==="erase"&&this.eraseAt(n)}}onTouchMove(t){t.preventDefault();for(let n=0;n<t.touches.length;n++){let e=t.touches[n],i=this.getTouchPoint(e);i&&this.touches.set(e.identifier,i)}if(t.touches.length===2&&this.initialPinchDistance!==null)this.handlePinchZoom();else if(t.touches.length===1){let n=this.getTouchPoint(t.touches[0]);if(!n)return;if(this.isDrawing&&this.mode()==="draw")this.addPointToPath(n);else if(this.isPanning&&this.mode()==="pan"){let e=this.getScreenPoint(t.touches[0]);this.pan(e)}else this.mode()==="erase"&&this.eraseAt(n)}}onTouchEnd(t){t.preventDefault();for(let n=0;n<t.changedTouches.length;n++){let e=t.changedTouches[n];this.touches.delete(e.identifier)}t.touches.length<2&&(this.initialPinchDistance=null,this.pinchCenter=null),t.touches.length===0&&(this.isDrawing&&this.finishDrawing(),this.isPanning=!1,this.panStartScreen=null)}onWheel(t){t.preventDefault();let n=this.getPoint(t);if(!n)return;let e=t.deltaY>0?.9:1.1;this.zoomAt(n,e)}getScreenPoint(t){let e=this.svgElement().nativeElement.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}getPoint(t){let n=this.getScreenPoint(t);return this.screenToSVG(n)}getTouchPoint(t){let e=this.svgElement().nativeElement.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;return this.screenToSVG({x:i,y:o})}screenToSVG(t){let e=this.svgElement().nativeElement.getBoundingClientRect(),i=this.viewBox(),o=i.x+t.x/e.width*i.width,r=i.y+t.y/e.height*i.height;return{x:o,y:r}}startDrawing(t){this.isDrawing=!0,this.currentPath=[t],this.lastPoint=t}addPointToPath(t){if(!this.isDrawing)return;this.currentPath.push(t),this.lastPoint=t;let e={d:this.pointsToPathData(this.currentPath),color:this.currentColor(),width:this.strokeWidth()};this.paths.update(i=>[...i.filter(r=>r!==i[i.length-1]||!this.isDrawing),e])}finishDrawing(){if(!this.isDrawing||this.currentPath.length===0){this.isDrawing=!1;return}let n={d:this.pointsToPathData(this.currentPath),color:this.currentColor(),width:this.strokeWidth()};this.paths.update(e=>[...e,n]),this.isDrawing=!1,this.currentPath=[],this.lastPoint=null}pointsToPathData(t){if(t.length===0)return"";if(t.length===1)return`M ${t[0].x} ${t[0].y} L ${t[0].x+.1} ${t[0].y+.1}`;let n=`M ${t[0].x} ${t[0].y}`;for(let e=1;e<t.length;e++)n+=` L ${t[e].x} ${t[e].y}`;return n}startPanning(t){this.isPanning=!0,this.panStartScreen=t}pan(t){if(!this.isPanning||!this.panStartScreen)return;let e=this.svgElement().nativeElement.getBoundingClientRect(),i=this.viewBox(),o=(t.x-this.panStartScreen.x)*(i.width/e.width),r=(t.y-this.panStartScreen.y)*(i.height/e.height);this.viewBox.update(s=>S(E({},s),{x:s.x-o,y:s.y-r})),this.panStartScreen=t}zoomAt(t,n){let e=this.scale()*n;if(e<.1||e>10)return;let i=this.viewBox(),o=i.width,r=i.height,s=o/n,h=r/n,d=(t.x-i.x)/o,v=(t.y-i.y)/r,w=t.x-d*s,P=t.y-v*h;this.scale.set(e),this.viewBox.set({x:w,y:P,width:s,height:h})}getPinchDistance(){let t=Array.from(this.touches.values());if(t.length<2)return 0;let n=t[1].x-t[0].x,e=t[1].y-t[0].y;return Math.sqrt(n*n+e*e)}getPinchCenter(){let t=Array.from(this.touches.values());return t.length<2?{x:0,y:0}:{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}handlePinchZoom(){if(this.initialPinchDistance===null||!this.pinchCenter)return;let n=this.getPinchDistance()/this.initialPinchDistance;this.zoomAt(this.pinchCenter,n/(this.scale()/this.initialScale))}eraseAt(t){let n=10/this.scale();this.paths.update(e=>e.filter(i=>!this.isPointNearPath(t,i,n)))}isPointNearPath(t,n,e){let i=n.d.match(/[ML]\s*[\d.-]+\s+[\d.-]+/g);if(!i)return!1;let o=null;for(let r of i){let s=r.match(/[\d.-]+/g);if(!s||s.length<2)continue;let h={x:parseFloat(s[0]),y:parseFloat(s[1])};if(o&&this.distanceToSegment(t,o,h)<e)return!0;o=h}return!1}distanceToSegment(t,n,e){let i=e.x-n.x,o=e.y-n.y,r=i*i+o*o;if(r===0)return Math.sqrt((t.x-n.x)**2+(t.y-n.y)**2);let s=((t.x-n.x)*i+(t.y-n.y)*o)/r;s=Math.max(0,Math.min(1,s));let h=n.x+s*i,d=n.y+s*o;return Math.sqrt((t.x-h)**2+(t.y-d)**2)}openSVG(){let t=document.createElement("input");t.type="file",t.accept=".svg",t.onchange=n=>{let e=n.target.files?.[0];if(!e)return;let i=new FileReader;i.onload=o=>{let r=o.target?.result;this.parseSVG(r)},i.readAsText(e)},t.click()}parseSVG(t){let i=new DOMParser().parseFromString(t,"image/svg+xml").querySelectorAll("path"),o=[];i.forEach(r=>{let s=r.getAttribute("d"),h=r.getAttribute("stroke")||"#000000",d=parseFloat(r.getAttribute("stroke-width")||"2");s&&o.push({d:s,color:h,width:d})}),this.paths.set(o),this.fitContentToView()}fitContentToView(){if(this.paths().length===0)return;let t=1/0,n=1/0,e=-1/0,i=-1/0;if(this.paths().forEach(et=>{let x=et.d.match(/[\d.-]+/g);if(x)for(let C=0;C<x.length;C+=2){let O=parseFloat(x[C]),B=parseFloat(x[C+1]);t=Math.min(t,O),n=Math.min(n,B),e=Math.max(e,O),i=Math.max(i,B)}}),!isFinite(t))return;let o=50,r=e-t,s=i-n,h=window.innerWidth,d=window.innerHeight,v=h/(r+o*2),w=d/(s+o*2),P=Math.min(v,w,1);this.scale.set(P);let _=h/P,W=d/P,K=(t+e)/2,tt=(n+i)/2;this.viewBox.set({x:K-_/2,y:tt-W/2,width:_,height:W})}saveSVG(){let t=this.generateSVGContent(),n=new Blob([t],{type:"image/svg+xml"}),e=URL.createObjectURL(n),i=document.createElement("a");i.href=e,i.download=`whiteboard-${Date.now()}.svg`,i.click(),URL.revokeObjectURL(e)}generateSVGContent(){let t=1/0,n=1/0,e=-1/0,i=-1/0;this.paths().forEach(d=>{let v=d.d.match(/[\d.-]+/g);if(v)for(let w=0;w<v.length;w+=2){let P=parseFloat(v[w]),_=parseFloat(v[w+1]);t=Math.min(t,P),n=Math.min(n,_),e=Math.max(e,P),i=Math.max(i,_)}});let o=20;t=isFinite(t)?t-o:0,n=isFinite(n)?n-o:0,e=isFinite(e)?e+o:1e3,i=isFinite(i)?i+o:1e3;let r=e-t,s=i-n,h=`<?xml version="1.0" encoding="UTF-8"?>
`;return h+=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${t} ${n} ${r} ${s}" style="width: 100vw; height: 100vh; display: block;">
`,h+=`  <rect x="${t}" y="${n}" width="${r}" height="${s}" fill="white"/>
`,this.paths().forEach(d=>{h+=`  <path d="${d.d}" stroke="${d.color}" stroke-width="${d.width}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
`}),h+="</svg>",h}setMode(t){this.mode.set(t)}clearCanvas(){this.paths.set([])}static \u0275fac=function(n){return new(n||f)};static \u0275cmp=y({type:f,selectors:[["app-whiteboard"]],viewQuery:function(n,e){n&1&&Y(e.svgElement,ot,5),n&2&&X()},decls:27,vars:10,consts:[["svgCanvas",""],[1,"whiteboard-container",3,"resize"],[1,"toolbar"],[1,"toolbar-section"],["title","Draw mode",1,"mode-btn",3,"click"],["title","Pan mode",1,"mode-btn",3,"click"],["title","Erase mode",1,"mode-btn",3,"click"],[1,"color-picker-label"],["type","color",1,"color-picker",3,"input","value"],[1,"slider-label"],["type","range","min","1","max","20",1,"width-slider",3,"input","value"],["title","Open SVG file",1,"action-btn",3,"click"],["title","Save as SVG",1,"action-btn",3,"click"],["title","Clear canvas",1,"action-btn","danger",3,"click"],[1,"svg-canvas",3,"pointerdown","pointermove","pointerup","pointerleave","touchstart","touchmove","touchend","touchcancel","wheel"],["fill","none","stroke-linecap","round","stroke-linejoin","round"]],template:function(n,e){if(n&1){let i=N();l(0,"div",1),u("resize",function(){return a(i),c(e.onWindowResize())},F),l(1,"div",2)(2,"div",3)(3,"button",4),u("click",function(){return a(i),c(e.setMode("draw"))}),m(4," \u270F\uFE0F Draw "),p(),l(5,"button",5),u("click",function(){return a(i),c(e.setMode("pan"))}),m(6," \u270B Pan "),p(),l(7,"button",6),u("click",function(){return a(i),c(e.setMode("erase"))}),m(8," \u{1F5D1}\uFE0F Erase "),p()(),l(9,"div",3)(10,"label",7),m(11," Color: "),l(12,"input",8),u("input",function(r){return a(i),c(e.currentColor.set(r.target.value))}),p()(),l(13,"label",9),m(14),l(15,"input",10),u("input",function(r){return a(i),c(e.strokeWidth.set(+r.target.value))}),p()()(),l(16,"div",3)(17,"button",11),u("click",function(){return a(i),c(e.openSVG())}),m(18," \u{1F4C2} Open "),p(),l(19,"button",12),u("click",function(){return a(i),c(e.saveSVG())}),m(20," \u{1F4BE} Save "),p(),l(21,"button",13),u("click",function(){return a(i),c(e.clearCanvas())}),m(22," \u{1F5D1}\uFE0F Clear "),p()()(),V(),l(23,"svg",14,0),u("pointerdown",function(r){return a(i),c(e.onPointerDown(r))})("pointermove",function(r){return a(i),c(e.onPointerMove(r))})("pointerup",function(){return a(i),c(e.onPointerUp())})("pointerleave",function(){return a(i),c(e.onPointerUp())})("touchstart",function(r){return a(i),c(e.onTouchStart(r))})("touchmove",function(r){return a(i),c(e.onTouchMove(r))})("touchend",function(r){return a(i),c(e.onTouchEnd(r))})("touchcancel",function(r){return a(i),c(e.onTouchEnd(r))})("wheel",function(r){return a(i),c(e.onWheel(r))}),A(25,rt,1,3,":svg:path",15,$),p()()}n&2&&(g(3),M("active",e.mode()==="draw"),g(2),M("active",e.mode()==="pan"),g(2),M("active",e.mode()==="erase"),g(5),T("value",e.currentColor()),g(2),H(" Width: ",e.strokeWidth(),"px "),g(),T("value",e.strokeWidth()),g(8),k("viewBox",e.viewBoxString()),g(2),L(e.paths()))},dependencies:[Q,Z],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh;overflow:hidden}.whiteboard-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;background:#f5f5f5}.toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;padding:.75rem 1rem;background:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 2px 4px #0000001a;z-index:10}@media (max-width: 768px){.toolbar[_ngcontent-%COMP%]{gap:.5rem;padding:.5rem}}.toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}@media (max-width: 768px){.toolbar-section[_ngcontent-%COMP%]{gap:.25rem}}.mode-btn[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #d0d0d0;border-radius:4px;background:#fff;cursor:pointer;font-size:.875rem;font-weight:500;transition:all .2s ease;white-space:nowrap}.mode-btn[_ngcontent-%COMP%]:hover, .action-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5;border-color:#b0b0b0}.mode-btn[_ngcontent-%COMP%]:active, .action-btn[_ngcontent-%COMP%]:active{transform:scale(.98)}@media (max-width: 768px){.mode-btn[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%]{padding:.4rem .6rem;font-size:.75rem}}.mode-btn.active[_ngcontent-%COMP%]{background:#2196f3;color:#fff;border-color:#1976d2}.mode-btn.active[_ngcontent-%COMP%]:hover{background:#1976d2}.action-btn.danger[_ngcontent-%COMP%]{color:#d32f2f}.action-btn.danger[_ngcontent-%COMP%]:hover{background:#ffebee;border-color:#d32f2f}.color-picker-label[_ngcontent-%COMP%], .slider-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;font-weight:500;color:#333}@media (max-width: 768px){.color-picker-label[_ngcontent-%COMP%], .slider-label[_ngcontent-%COMP%]{font-size:.75rem;gap:.25rem}}.color-picker[_ngcontent-%COMP%]{width:40px;height:32px;border:1px solid #d0d0d0;border-radius:4px;cursor:pointer}@media (max-width: 768px){.color-picker[_ngcontent-%COMP%]{width:32px;height:28px}}.width-slider[_ngcontent-%COMP%]{width:100px;cursor:pointer}@media (max-width: 768px){.width-slider[_ngcontent-%COMP%]{width:80px}}.svg-canvas[_ngcontent-%COMP%]{flex:1;width:100%;height:100%;touch-action:none;cursor:crosshair;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;background:#fff}.whiteboard-container[data-mode=pan][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%]{cursor:grab}.whiteboard-container[data-mode=pan][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%]:active{cursor:grabbing}.whiteboard-container[data-mode=erase][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})};var J=class f{static \u0275fac=function(n){return new(n||f)};static \u0275cmp=y({type:f,selectors:[["app-page1"]],decls:3,vars:0,template:function(n,e){n&1&&(G(0,"h1"),m(1,"Page 1"),z(),R(2,"app-whiteboard"))},dependencies:[D],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh}h1[_ngcontent-%COMP%]{margin:0;padding:.5rem 1rem;font-size:1.25rem;background:#f5f5f5;border-bottom:1px solid #ddd}app-whiteboard[_ngcontent-%COMP%]{flex:1;min-height:0}"],changeDetection:0})};export{J as Page1Component};
