import{a as Z}from"./chunk-MCFMJEAI.js";import{$a as h,Ca as A,Ja as N,Na as Y,Oa as z,Pa as R,Qa as d,Ra as l,Sa as B,Ta as H,Ua as M,V as a,Va as U,W as c,Wa as u,X,Xa as G,Ya as j,Za as q,ab as K,bb as Q,c as F,ca as b,fb as I,jb as L,pa as k,qa as m,sb as J}from"./chunk-IPLMCEMV.js";var ne=["svgCanvas"],oe=["contentGroup"],V=class S{svgElement=L.required("svgCanvas");contentGroup=L.required("contentGroup");paths=b([]);currentColor=b("#0c62f0");strokeWidth=b(6);mode=b("draw");scale=b(1);tx=b(0);ty=b(0);MIN_SCALE=.05;MAX_SCALE=20;isDrawing=!1;activePath=null;activePathColor="";activePathWidth=0;isPanning=!1;panPointerId=null;panAnchorWorld=null;pointers=new Map;pinchActive=!1;pinchInitialScale=1;pinchInitialDist=1;pinchAnchorWorld=null;erasePrevScreen=null;spacePressed=!1;transform=I(()=>`translate(${this.tx()},${this.ty()}) scale(${this.scale()})`);status=I(()=>{let e=this.scale(),i=this.tx(),t=this.ty(),n=this.mode();return`scale=${e.toFixed(3)} tx=${i.toFixed(1)} ty=${t.toFixed(1)} | mode=${n}`});cursor=I(()=>this.mode()==="pan"||this.spacePressed?this.isPanning?"grabbing":"grab":"crosshair");nextId=0;generateId(){return`path-${Date.now()}-${this.nextId++}`}onWindowResize(){}onKeyDown(e){e.code==="Space"&&!e.repeat&&(this.spacePressed=!0,e.preventDefault())}onKeyUp(e){e.code==="Space"&&(this.spacePressed=!1)}getBoardRect(){return this.svgElement().nativeElement.getBoundingClientRect()}screenToLocalCanvas(e,i){let t=this.getBoardRect();return{x:e-t.left,y:i-t.top}}screenToWorld(e,i){let{x:t,y:n}=this.screenToLocalCanvas(e,i);return{x:(t-this.tx())/this.scale(),y:(n-this.ty())/this.scale()}}dist2D(e,i){return Math.hypot(e.x-i.x,e.y-i.y)}sampleSegmentPoints(e,i,t=8){let n=this.dist2D(e,i),o=Math.max(1,Math.ceil(n/t)),r=[];for(let s=0;s<=o;s++){let p=s/o;r.push({x:e.x+(i.x-e.x)*p,y:e.y+(i.y-e.y)*p})}return r}clampScale(e){return Math.min(this.MAX_SCALE,Math.max(this.MIN_SCALE,e))}shouldPan(e){return!!(e.button===1||this.spacePressed&&e.button===0||this.mode()==="pan"&&e.button===0)}onPointerDown(e){if(this.svgElement().nativeElement.setPointerCapture(e.pointerId),this.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),this.pointers.size===2&&this.mode()!=="erase"){this.endDraw(),this.isPanning=!1,this.startPinch();return}if(this.shouldPan(e)){this.startPan(e);return}this.mode()==="draw"?this.startDraw(e):this.mode()==="erase"&&this.startErase(e)}onPointerMove(e){if(this.pointers.has(e.pointerId)&&this.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),this.pinchActive){this.updatePinch();return}if(this.isPanning){this.continuePan(e);return}this.mode()==="draw"?this.continueDraw(e):this.mode()==="erase"&&this.continueErase(e)}onPointerUp(e){let i=this.svgElement().nativeElement;this.pointers.has(e.pointerId)&&this.pointers.delete(e.pointerId),this.pinchActive&&this.pointers.size<2&&this.endPinch(),this.isPanning&&this.endPan(e),this.mode()==="draw"?this.endDraw():this.mode()==="erase"&&this.endErase(),i.releasePointerCapture(e.pointerId)}onPointerCancel(e){let i=this.svgElement().nativeElement;this.pointers.has(e.pointerId)&&this.pointers.delete(e.pointerId),this.pinchActive&&this.pointers.size<2&&this.endPinch(),this.endDraw(),this.endPan(e),this.endErase(),i.releasePointerCapture(e.pointerId)}onWheel(e){e.preventDefault();let i=Math.pow(1.0015,-e.deltaY),t=this.screenToWorld(e.clientX,e.clientY),n=this.screenToLocalCanvas(e.clientX,e.clientY),o=this.clampScale(this.scale()*i);this.tx.set(n.x-o*t.x),this.ty.set(n.y-o*t.y),this.scale.set(o)}startDraw(e){if(this.pointers.size>1)return;this.isDrawing=!0;let{x:i,y:t}=this.screenToWorld(e.clientX,e.clientY);this.activePathColor=this.currentColor(),this.activePathWidth=this.strokeWidth(),this.activePath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.activePath.setAttribute("fill","none"),this.activePath.setAttribute("stroke",this.activePathColor),this.activePath.setAttribute("stroke-width",String(this.activePathWidth)),this.activePath.setAttribute("stroke-linecap","round"),this.activePath.setAttribute("stroke-linejoin","round"),this.activePath.setAttribute("d",`M ${i} ${t}`),this.contentGroup().nativeElement.appendChild(this.activePath)}continueDraw(e){if(!this.isDrawing||!this.activePath)return;let{x:i,y:t}=this.screenToWorld(e.clientX,e.clientY),n=this.activePath.getAttribute("d")+` L ${i} ${t}`;this.activePath.setAttribute("d",n)}endDraw(){if(this.isDrawing&&this.activePath){let e=this.activePath.getAttribute("d")||"",i={id:this.generateId(),d:e,color:this.activePathColor,width:this.activePathWidth};this.activePath.setAttribute("data-id",i.id),this.paths.update(t=>[...t,i])}this.isDrawing=!1,this.activePath=null,this.activePathColor="",this.activePathWidth=0}startPan(e){this.isPanning=!0,this.panPointerId=e.pointerId,this.panAnchorWorld=this.screenToWorld(e.clientX,e.clientY)}continuePan(e){if(!this.isPanning||e.pointerId!==this.panPointerId||!this.panAnchorWorld)return;let i=this.screenToLocalCanvas(e.clientX,e.clientY);this.tx.set(i.x-this.scale()*this.panAnchorWorld.x),this.ty.set(i.y-this.scale()*this.panAnchorWorld.y)}endPan(e){e.pointerId===this.panPointerId&&(this.isPanning=!1,this.panPointerId=null,this.panAnchorWorld=null)}startPinch(){let e=Array.from(this.pointers.keys());if(e.length!==2)return;this.pinchActive=!0;let i=this.pointers.get(e[0]),t=this.pointers.get(e[1]),n={x:(i.x+t.x)/2,y:(i.y+t.y)/2};this.pinchInitialDist=this.dist2D(i,t),this.pinchInitialScale=this.scale(),this.pinchAnchorWorld=this.screenToWorld(n.x,n.y)}updatePinch(){let e=Array.from(this.pointers.keys());if(e.length!==2||!this.pinchActive||!this.pinchAnchorWorld)return;let i=this.pointers.get(e[0]),t=this.pointers.get(e[1]),n=this.dist2D(i,t),o=this.pinchInitialScale*(n/this.pinchInitialDist);o=this.clampScale(o);let r={x:(i.x+t.x)/2,y:(i.y+t.y)/2},s=this.screenToLocalCanvas(r.x,r.y);this.tx.set(s.x-o*this.pinchAnchorWorld.x),this.ty.set(s.y-o*this.pinchAnchorWorld.y),this.scale.set(o)}endPinch(){this.pinchActive=!1,this.pinchAnchorWorld=null}startErase(e){this.erasePrevScreen={x:e.clientX,y:e.clientY},this.eraseAtPoint(e.clientX,e.clientY)}continueErase(e){let i={x:e.clientX,y:e.clientY};if(!this.erasePrevScreen){this.erasePrevScreen=i;return}let t=this.sampleSegmentPoints(this.erasePrevScreen,i,8),n=new Set;for(let o of t){let r=document.elementFromPoint(o.x,o.y);if(!r)continue;let s=r.getAttribute?.("data-id");s&&r.closest?.("#contentGroup")&&n.add(s)}n.size>0&&(this.paths.update(o=>o.filter(r=>!n.has(r.id))),n.forEach(o=>{this.contentGroup().nativeElement.querySelector(`[data-id="${o}"]`)?.remove()})),this.erasePrevScreen=i}eraseAtPoint(e,i){let t=document.elementFromPoint(e,i);if(!t)return;let n=t.getAttribute?.("data-id");n&&t.closest?.("#contentGroup")&&(this.paths.update(o=>o.filter(r=>r.id!==n)),t.remove())}endErase(){this.erasePrevScreen=null}onFileSelected(e){return F(this,null,function*(){let i=e.target,t=i.files?.[0];if(t)try{let n=yield t.text(),r=new DOMParser().parseFromString(n,"image/svg+xml").documentElement,s=this.contentGroup().nativeElement;for(;s.firstChild;)s.removeChild(s.firstChild);this.tx.set(0),this.ty.set(0),this.scale.set(1);let p=E=>{for(let w of Array.from(E.childNodes)){if(w.nodeType!==1)continue;let y=w,f=y.tagName.toLowerCase();if(["style","script","title","desc","defs"].includes(f))continue;if(f==="g"){p(y);continue}let _=document.importNode(y,!0),x=this.generateId();_.setAttribute("data-id",x),f==="path"&&_.setAttribute("fill","none"),s.appendChild(_)}};p(r),this.fitToView()}catch(n){console.error(n),alert("Failed to parse SVG file.")}finally{i.value=""}})}fitToView(){let i=this.contentGroup().nativeElement.querySelectorAll("path");if(i.length===0){this.tx.set(0),this.ty.set(0),this.scale.set(1);return}let t=1/0,n=1/0,o=-1/0,r=-1/0;if(i.forEach($=>{let v=($.getAttribute("d")||"").match(/[\d.-]+/g);if(v)for(let P=0;P<v.length;P+=2){let C=parseFloat(v[P]),T=parseFloat(v[P+1]);!isNaN(C)&&!isNaN(T)&&(t=Math.min(t,C),n=Math.min(n,T),o=Math.max(o,C),r=Math.max(r,T))}}),!isFinite(t)){this.tx.set(0),this.ty.set(0),this.scale.set(1);return}let s=50,p=o-t+s*2,E=r-n+s*2,w=this.getBoardRect(),y=w.width,f=w.height,_=y/p,x=f/E,g=Math.min(_,x,1),O=(t+o)/2,W=(n+r)/2;this.scale.set(g),this.tx.set(y/2-O*g),this.ty.set(f/2-W*g)}saveSVG(){let i=this.contentGroup().nativeElement.querySelectorAll("path");if(i.length===0){alert("Nothing to save");return}let t=1/0,n=1/0,o=-1/0,r=-1/0;i.forEach(W=>{let D=(W.getAttribute("d")||"").match(/[\d.-]+/g);if(D)for(let v=0;v<D.length;v+=2){let P=parseFloat(D[v]),C=parseFloat(D[v+1]);!isNaN(P)&&!isNaN(C)&&(t=Math.min(t,P),n=Math.min(n,C),o=Math.max(o,P),r=Math.max(r,C))}});let s=20;t-=s,n-=s,o+=s,r+=s;let p=o-t,E=r-n,w=Array.from(i).map(W=>new XMLSerializer().serializeToString(W)).join(`
`),f=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="${t} ${n} ${p} ${E}" preserveAspectRatio="xMidYMid meet">

  <style>
    html, body { height: 100%; margin: 0; background: #fff; }
    svg { width: 100vw; height: 100vh; display: block; background: #fff; }
    path { fill: none; stroke-linecap: round; stroke-linejoin: round; }
  </style>
<rect x="${t}" y="${n}" width="${p}" height="${E}" fill="white"/>
${w}
</svg>`,_=new Blob([f],{type:"image/svg+xml"}),x=URL.createObjectURL(_),g=document.createElement("a"),O=new Date().toISOString().replace(/[:.]/g,"-");g.download=`whiteboard-${O}.svg`,g.href=x,document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(x)}setMode(e){this.mode.set(e)}clearCanvas(){this.paths.set([]);let e=this.contentGroup().nativeElement;for(;e.firstChild;)e.removeChild(e.firstChild);this.tx.set(0),this.ty.set(0),this.scale.set(1)}static \u0275fac=function(i){return new(i||S)};static \u0275cmp=A({type:S,selectors:[["app-whiteboard3"]],viewQuery:function(i,t){i&1&&(G(t.svgElement,ne,5),G(t.contentGroup,oe,5)),i&2&&j(2)},hostBindings:function(i,t){i&1&&U("resize",function(){return t.onWindowResize()},k)("keydown",function(o){return t.onKeyDown(o)},k)("keyup",function(o){return t.onKeyUp(o)},k)},decls:39,vars:11,consts:[["fileInput",""],["svgCanvas",""],["contentGroup",""],[1,"whiteboard-container"],[1,"toolbar"],[1,"toolbar-section"],["for","openFile",1,"file-btn"],["id","openFile","type","file","accept",".svg,image/svg+xml","hidden","",3,"change"],["title","Save as SVG",1,"action-btn",3,"click"],[1,"input-label"],["type","color",1,"color-picker",3,"input","value"],["type","range","min","1","max","40",1,"width-slider",3,"input","value"],[1,"width-value"],[1,"toolbar-section","mode-group"],[1,"mode-radio"],["type","radio","name","mode","value","draw",3,"change","checked"],["type","radio","name","mode","value","pan",3,"change","checked"],["type","radio","name","mode","value","erase",3,"change","checked"],["title","Clear canvas",1,"action-btn","danger",3,"click"],[1,"status"],[1,"board-wrapper"],[1,"svg-canvas",3,"pointerdown","pointermove","pointerup","pointercancel","pointerleave","wheel","auxclick"],["x","0","y","0","width","100%","height","100%","fill","white",1,"hit-area"],["id","contentGroup"]],template:function(i,t){if(i&1){let n=H();d(0,"div",3)(1,"div",4)(2,"div",5)(3,"label",6),h(4,"Open SVG"),l(),d(5,"input",7,0),u("change",function(r){return a(n),c(t.onFileSelected(r))}),l(),d(7,"button",8),u("click",function(){return a(n),c(t.saveSVG())}),h(8,"Save SVG"),l()(),d(9,"div",5)(10,"label",9),h(11," Color: "),d(12,"input",10),u("input",function(r){return a(n),c(t.currentColor.set(r.target.value))}),l()(),d(13,"label",9),h(14," Width: "),d(15,"input",11),u("input",function(r){return a(n),c(t.strokeWidth.set(+r.target.value))}),l(),d(16,"span",12),h(17),l()()(),d(18,"div",13)(19,"label",14)(20,"input",15),u("change",function(){return a(n),c(t.setMode("draw"))}),l(),h(21," Draw "),l(),d(22,"label",14)(23,"input",16),u("change",function(){return a(n),c(t.setMode("pan"))}),l(),h(24," Pan "),l(),d(25,"label",14)(26,"input",17),u("change",function(){return a(n),c(t.setMode("erase"))}),l(),h(27," Erase "),l()(),d(28,"div",5)(29,"button",18),u("click",function(){return a(n),c(t.clearCanvas())}),h(30,"Clear"),l()(),d(31,"span",19),h(32),l()(),d(33,"div",20),X(),d(34,"svg",21,1),u("pointerdown",function(r){return a(n),c(t.onPointerDown(r))})("pointermove",function(r){return a(n),c(t.onPointerMove(r))})("pointerup",function(r){return a(n),c(t.onPointerUp(r))})("pointercancel",function(r){return a(n),c(t.onPointerCancel(r))})("pointerleave",function(r){return a(n),c(t.onPointerUp(r))})("wheel",function(r){return a(n),c(t.onWheel(r))})("auxclick",function(r){return a(n),c(r.preventDefault())}),B(36,"rect",22)(37,"g",23,2),l()()()}i&2&&(N("data-mode",t.mode()),m(12),M("value",t.currentColor()),m(3),M("value",t.strokeWidth()),m(2),Q("",t.strokeWidth(),"px"),m(3),M("checked",t.mode()==="draw"),m(3),M("checked",t.mode()==="pan"),m(3),M("checked",t.mode()==="erase"),m(6),K(t.status()),m(2),q("cursor",t.cursor()),m(3),N("transform",t.transform()))},dependencies:[J,Z],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh;overflow:hidden}.whiteboard-container[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto 1fr;width:100%;height:100vh;background:#f7f7f7;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif}.toolbar[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;padding:10px 12px;background:#fff;border-bottom:1px solid #ddd;position:sticky;top:0;z-index:10;-webkit-user-select:none;user-select:none;flex-wrap:wrap}@media (max-width: 640px){.toolbar[_ngcontent-%COMP%]{gap:8px}}.toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}@media (max-width: 640px){.toolbar-section[_ngcontent-%COMP%]{gap:8px}}.mode-group[_ngcontent-%COMP%]{display:inline-flex;gap:12px;align-items:center}.mode-radio[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;font-size:14px;cursor:pointer}.input-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:14px}.width-value[_ngcontent-%COMP%]{min-width:32px}.color-picker[_ngcontent-%COMP%]{width:40px;height:28px;border:1px solid #aaa;border-radius:4px;cursor:pointer;padding:0}.width-slider[_ngcontent-%COMP%]{width:80px;cursor:pointer}.file-btn[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%]{padding:6px 10px;border:1px solid #aaa;border-radius:6px;background:#fafafa;cursor:pointer;font-size:14px}.file-btn[_ngcontent-%COMP%]:hover, .action-btn[_ngcontent-%COMP%]:hover{background:#f0f0f0}.file-btn[_ngcontent-%COMP%]{display:inline-block}.action-btn.danger[_ngcontent-%COMP%]{color:#d32f2f}.action-btn.danger[_ngcontent-%COMP%]:hover{background:#ffebee;border-color:#d32f2f}.status[_ngcontent-%COMP%]{margin-left:auto;color:#666;font-size:12px}@media (max-width: 640px){.status[_ngcontent-%COMP%]{flex-basis:100%;margin-left:0}}.board-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow:hidden;background:#fff}.svg-canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block;touch-action:none;background:#fff}.hit-area[_ngcontent-%COMP%]{fill:#fff}.whiteboard-container[data-mode=pan][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%]{cursor:grab}.whiteboard-container[data-mode=pan][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%]:active{cursor:grabbing}.whiteboard-container[data-mode=erase][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%], .whiteboard-container[data-mode=draw][_ngcontent-%COMP%]   .svg-canvas[_ngcontent-%COMP%]{cursor:crosshair}"],changeDetection:0})};var ee=class S{static \u0275fac=function(i){return new(i||S)};static \u0275cmp=A({type:S,selectors:[["app-page3"]],decls:3,vars:0,template:function(i,t){i&1&&(Y(0,"h1"),h(1,"Page 3"),z(),R(2,"app-whiteboard3"))},dependencies:[V],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh}h1[_ngcontent-%COMP%]{margin:0;padding:.5rem 1rem;font-size:1.25rem;background:#f5f5f5;border-bottom:1px solid #ddd}app-whiteboard3[_ngcontent-%COMP%]{flex:1;min-height:0}"],changeDetection:0})};export{ee as Page3Component};
